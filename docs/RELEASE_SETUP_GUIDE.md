# Prio ‚Äî Release & Environment Setup Guide

> **Author**: Infrastructure Engineer  
> **Created**: February 10, 2026  
> **Status**: Actionable ‚Äî blocking items identified for release builds  
> **Audience**: Project owner / lead developer

---

## Overview

This document captures all manual setup steps required to build and distribute Prio. The codebase is fully wired for Firebase Crashlytics, ProGuard, and on-device AI ‚Äî but certain credentials and keys **must be created by a human** and cannot be committed to source control.

### Quick Status Matrix

| Requirement | Debug | Release | Current State | Action Required |
|-------------|:-----:|:-------:|---------------|-----------------|
| Firebase Crashlytics plugin & deps | N/A (disabled) | ‚úÖ Needed | ‚úÖ Fully configured | None |
| `CrashReportingTree` (Timber ‚Üí Crashlytics) | N/A (disabled) | ‚úÖ Needed | ‚úÖ Implemented | None |
| ProGuard keep rules for crash reports | N/A | ‚úÖ Needed | ‚úÖ Configured | None |
| Real `google-services.json` | ‚ùå Not needed | ‚úÖ **BLOCKING** | ‚ùå Placeholder | [Create Firebase project](#1-firebase-project--crashlytics) |
| Release signing keystore | ‚ùå Not needed | ‚úÖ **BLOCKING** | ‚ùå Missing | [Generate keystore](#2-release-signing-keystore) |
| Play Store publishing pipeline | ‚ùå Not needed | ‚ö° Nice-to-have | ‚ùå Not configured | [Add when ready](#3-play-store-publishing-pipeline) |
| On-device model documentation | ‚ö†Ô∏è Helpful | ‚ö†Ô∏è Helpful | ‚ùå Undocumented | [Document setup](#4-on-device-llm-model-setup) |

---

## Debug Build ‚Äî What Works Today

Debug builds require **zero manual setup** beyond having the Android SDK installed. The following safeguards are already in place:

- **Firebase completely disabled** ‚Äî `debug/AndroidManifest.xml` sets:
  - `firebase_crashlytics_collection_enabled = false`
  - `firebase_analytics_collection_enabled = false`
  - `FirebaseInitProvider` removed via `tools:node="remove"`
- **Placeholder `google-services.json`** ‚Äî uses fake project ID `prio-placeholder` and API key `placeholder_api_key_replace_with_real_key`. This is intentional and won't cause crashes in debug because Firebase is disabled.
- **Debug signing** ‚Äî uses the default Android debug keystore (auto-generated by Android Studio).
- **Crashlytics mapping upload disabled** ‚Äî `mappingFileUploadEnabled = false` in debug build type.

**To build and run debug**:
```bash
cd android
./gradlew assembleDebug          # Build APK
./gradlew installDebug            # Install on connected device
./gradlew testDebugUnitTest       # Run unit tests
./gradlew connectedDebugAndroidTest  # Run instrumented tests
```

No manual steps required. ‚úÖ

---

## Release Build ‚Äî What Needs Manual Setup

### 1. Firebase Project & Crashlytics

**Status**: üî¥ BLOCKING for release  
**When**: Before first release build (Phase 5 ‚Äî Milestone 5.1)  
**Effort**: ~30 minutes  
**Who**: Project owner (requires Google account with Firebase access)

#### What's Already Done ‚úÖ

| Component | File | Status |
|-----------|------|--------|
| Google Services plugin | `android/build.gradle.kts` | `com.google.gms.google-services` v4.4.1 applied |
| Crashlytics Gradle plugin | `android/build.gradle.kts` | `com.google.firebase.crashlytics` v2.9.9 applied |
| Firebase BOM | `gradle/libs.versions.toml` | `firebaseBom = "32.7.2"` |
| Analytics dependency | `app/build.gradle.kts` | `firebase-analytics-ktx` via BOM |
| Crashlytics dependency | `app/build.gradle.kts` | `firebase-crashlytics-ktx` via BOM |
| Crash reporting code | `PrioApplication.kt` | `CrashReportingTree` logs WARN/ERROR to Crashlytics |
| ProGuard rules | `app/proguard-rules.pro` | Keeps `SourceFile`, `LineNumberTable`, `Exception` subclasses |
| Release mapping upload | `app/build.gradle.kts` | `mappingFileUploadEnabled = true` |
| Debug disabled | `debug/AndroidManifest.xml` | All Firebase auto-init removed |

#### What You Need to Do

**Step 1** ‚Äî Create Firebase project:
1. Go to [Firebase Console](https://console.firebase.google.com/)
2. Click **"Add project"** ‚Üí name it `Prio` (or `prio-prod`)
3. Enable Google Analytics when prompted (needed for Crashlytics)
4. Wait for project creation (~30 seconds)

**Step 2** ‚Äî Register the Android app:
1. In Firebase project, click **"Add app"** ‚Üí select **Android**
2. Package name: `com.prio.app`
3. App nickname: `Prio`
4. Debug signing certificate SHA-1 (optional for Crashlytics, but good practice):
   ```bash
   keytool -list -v -keystore ~/.android/debug.keystore -alias androiddebugkey -storepass android -keypass android 2>/dev/null | grep SHA1
   ```
5. Click **"Register app"**

**Step 3** ‚Äî Download and replace `google-services.json`:
1. Firebase Console will offer a download of `google-services.json`
2. Save it to `android/app/google-services.json` (overwrite the placeholder)
3. Verify it has real values (not `000000000000` or `placeholder_api_key`)

**Step 4** ‚Äî Enable Crashlytics:
1. In Firebase Console sidebar ‚Üí **Crashlytics**
2. Click **"Enable Crashlytics"**
3. It will say "waiting for your first crash report" ‚Äî this is normal

**Step 5** ‚Äî Verify:
```bash
cd android
./gradlew assembleRelease  # Should complete without google-services errors
```

> **Note**: If you also want a separate Firebase project for debug/staging, register a second app with package `com.prio.app.debug` in the same or different Firebase project, and use the product flavors approach. For MVP, a single project with release-only Crashlytics is sufficient.

---

### 2. Release Signing Keystore

**Status**: üî¥ BLOCKING for release  
**When**: Before first release build (Phase 5 ‚Äî Milestone 5.1.5)  
**Effort**: ~15 minutes  
**Who**: Project owner (keystore is a secret ‚Äî never commit to git)

#### What's Already Done ‚úÖ

- `.gitignore` excludes `*.jks` and `*.keystore` files
- Benchmark build type uses debug signing (correct for benchmarking)
- ProGuard/R8 is configured for release with `isMinifyEnabled = true`

#### What You Need to Do

**Step 1** ‚Äî Generate the release keystore:
```bash
keytool -genkey -v \
  -keystore ~/prio-release.jks \
  -keyalg RSA \
  -keysize 2048 \
  -validity 10000 \
  -alias prio-release
```
You'll be prompted for:
- Keystore password (use a strong password, save it securely)
- Key password (can be same as keystore password)
- Name, organization, etc. (used in certificate ‚Äî fill in real info)

**Step 2** ‚Äî Store credentials securely:
- **Never** commit the `.jks` file or passwords to git
- Store the keystore in a secure location with backup (e.g., password manager, encrypted cloud storage)
- For CI/CD, use encrypted secrets (GitHub Actions secrets, etc.)

**Step 3** ‚Äî Add signing properties to `android/local.properties`:
```properties
# Release signing (local only ‚Äî .gitignore'd)
RELEASE_STORE_FILE=/absolute/path/to/prio-release.jks
RELEASE_STORE_PASSWORD=your_keystore_password
RELEASE_KEY_ALIAS=prio-release
RELEASE_KEY_PASSWORD=your_key_password
```

**Step 4** ‚Äî Add signing config to `android/app/build.gradle.kts`:

Add the `signingConfigs` block inside `android { }`, **before** the `buildTypes` block:

```kotlin
signingConfigs {
    create("release") {
        val props = rootProject.file("local.properties")
        if (props.exists()) {
            val localProperties = java.util.Properties().apply { load(props.inputStream()) }
            storeFile = file(localProperties.getProperty("RELEASE_STORE_FILE", ""))
            storePassword = localProperties.getProperty("RELEASE_STORE_PASSWORD", "")
            keyAlias = localProperties.getProperty("RELEASE_KEY_ALIAS", "")
            keyPassword = localProperties.getProperty("RELEASE_KEY_PASSWORD", "")
        }
    }
}
```

Then update the `release` build type to use it:

```kotlin
buildTypes {
    release {
        isMinifyEnabled = true
        isShrinkResources = true
        signingConfig = signingConfigs.getByName("release")  // ‚Üê Add this line
        // ... rest of release config
    }
}
```

**Step 5** ‚Äî Verify:
```bash
cd android
./gradlew assembleRelease
# Should produce a signed APK at app/build/outputs/apk/release/
```

**Step 6** ‚Äî Enroll in Play App Signing (at upload time):
When uploading to Google Play Console for the first time, enroll in **Google Play App Signing**. Google will manage the distribution key; your upload key (the one you just created) is used only to authenticate uploads.

---

### 3. Play Store Publishing Pipeline

**Status**: üü° Nice-to-have for launch, not blocking  
**When**: Phase 5 ‚Äî Milestone 5.1.8 (before beta distribution)  
**Effort**: ~2 hours  
**Who**: Android Developer

#### Current State

No publishing automation exists. The first release can be uploaded manually to Play Console. For ongoing releases, consider one of:

| Option | Pros | Cons |
|--------|------|------|
| **Manual upload** | Zero setup, fine for first launch | Tedious for ongoing releases |
| **Triple-T Gradle plugin** | Gradle-native, manages listings + APKs | Requires service account JSON |
| **Fastlane** | Rich ecosystem, multi-platform | Ruby dependency, more setup |
| **GitHub Actions + gradle** | CI/CD integration, automated | Requires secrets management |

#### Recommended: Manual for MVP, automate post-launch

**For MVP launch (Phase 5)**:
1. Build signed AAB: `./gradlew bundleRelease`
2. Upload `app/build/outputs/bundle/release/app-release.aab` to Play Console manually
3. Fill in listing, screenshots, privacy policy

**Post-launch (Phase 6)**: Set up GitHub Actions with:
- Keystore as encrypted secret
- `google-services.json` as encrypted secret
- Automated build + upload to internal/beta track on tag push

---

### 4. On-Device LLM Model Setup

**Status**: üü° Nice-to-have for developer documentation  
**When**: Anytime (improves developer onboarding)  
**Effort**: ~30 minutes to document  
**Who**: Android Developer

#### Current State

- `models/` directory contains pre-downloaded `.gguf` files (Phi-3 2.2GB, Mistral 4.1GB)
- The app's `OnDeviceAiProvider` handles model download from HuggingFace URLs at runtime
- **No documentation** explains how to pre-load models for offline development/testing
- `.gitignore` has `# *.gguf` (commented out) ‚Äî the large files may or may not be tracked

#### For Debug Testing

Models are downloaded on-demand by the app. For offline development:
1. Push a model to the emulator/device:
   ```bash
   adb push models/Phi-3-mini-4k-instruct-q4.gguf /sdcard/Download/
   ```
2. The app's model manager should detect local files (implementation-dependent)

#### For Release

No action needed ‚Äî the app handles model download via `OnDeviceAiProvider`. With Milestone 3.6 (Gemini Nano), flagship devices won't need any model download at all.

---

## Timeline Summary

| Phase | Action | Blocking? | Effort |
|-------|--------|:---------:|--------|
| **Now (development)** | Nothing ‚Äî debug builds work as-is | ‚Äî | 0 |
| **Phase 4 (Polish)** | *(Optional)* Document model setup in README | No | 30 min |
| **Phase 5.1 (Release Prep)** | Create Firebase project + real `google-services.json` | **Yes** | 30 min |
| **Phase 5.1.5 (Release Prep)** | Generate release keystore + signing config | **Yes** | 15 min |
| **Phase 5.1.8 (Release Prep)** | Build signed AAB, upload to Play Console | **Yes** | 1 hr |
| **Phase 6 (Post-Launch)** | *(Optional)* Set up CI/CD publishing pipeline | No | 2 hr |

---

## Security Checklist

Before release, verify these security requirements (per `docs/SECURITY_GUIDELINES.md`):

- [ ] `google-services.json` contains real Firebase project credentials
- [ ] Release keystore is stored securely outside the repository
- [ ] Keystore passwords are not committed to git (only in `local.properties` which is `.gitignore`d)
- [ ] Firebase Crashlytics is enabled in Firebase Console
- [ ] Firebase Analytics collection is **disabled** in debug builds (already done ‚úÖ)
- [ ] No hardcoded API keys or secrets in source code (already clean ‚úÖ)
- [ ] ProGuard/R8 minification enabled for release (already done ‚úÖ)
- [ ] Play App Signing enrollment planned for first upload

---

*This document will be updated as items are completed. All Phase 5 blocking items are tracked in [ACTION_PLAN.md](ACTION_PLAN.md) under Milestone 5.1.*
