# 1.2.12 Kotlin Serialization for AI Types

**Task**: Configure Kotlin Serialization for AI types  
**Owner**: Android Developer  
**Status**: âœ… Completed  
**Date**: February 4, 2026

---

## Overview

Kotlin Serialization is configured for AI request/response types to enable:
1. On-device LLM prompt/response handling
2. Future cloud API integration
3. Consistent type contracts across providers

---

## AI Request Types

### AiRequest

```kotlin
@Serializable
data class AiRequest(
    val type: AiRequestType,
    val input: String,
    val context: AiContext? = null,
    val options: AiRequestOptions = AiRequestOptions()
)
```

### AiRequestType

```kotlin
@Serializable
enum class AiRequestType {
    CLASSIFY_EISENHOWER,
    PARSE_TASK,
    SUGGEST_SMART_GOAL,
    GENERATE_BRIEFING,
    EXTRACT_ACTION_ITEMS,
    GENERAL_CHAT
}
```

### AiContext

```kotlin
@Serializable
data class AiContext(
    val existingGoals: List<String> = emptyList(),
    val recentTasks: List<String> = emptyList(),
    val currentTime: String? = null,
    val userTimezone: String? = null,
    val previousQuadrant: EisenhowerQuadrant? = null
)
```

---

## AI Response Types

### AiResponse

```kotlin
@Serializable
data class AiResponse(
    val success: Boolean,
    val result: AiResult?,
    val error: String? = null,
    val metadata: AiResponseMetadata = AiResponseMetadata()
)
```

### AiResult (Sealed Interface)

```kotlin
@Serializable
sealed interface AiResult {
    
    @Serializable
    data class EisenhowerClassification(
        val quadrant: EisenhowerQuadrant,
        val confidence: Float,
        val explanation: String,
        val isUrgent: Boolean,
        val isImportant: Boolean
    ) : AiResult
    
    @Serializable
    data class ParsedTask(
        val title: String,
        val dueDate: String? = null,
        val dueTime: String? = null,
        val priority: String? = null,
        val suggestedQuadrant: EisenhowerQuadrant? = null,
        val confidence: Float = 0f
    ) : AiResult
    
    // ... other result types
}
```

### AiResponseMetadata

```kotlin
@Serializable
data class AiResponseMetadata(
    val provider: String = "unknown",
    val model: String = "unknown",
    val latencyMs: Long = 0,
    val tokensUsed: Int = 0,
    val wasRuleBased: Boolean = false,
    val wasLlmFallback: Boolean = false
)
```

---

## API Contract Example

### Eisenhower Classification Request

```json
{
  "type": "CLASSIFY_EISENHOWER",
  "input": "Call dentist tomorrow at 2pm",
  "context": {
    "existingGoals": ["Improve health"],
    "currentTime": "2026-02-04T09:00:00"
  },
  "options": {
    "maxTokens": 256,
    "temperature": 0.3,
    "useLlm": true,
    "fallbackToRuleBased": true
  }
}
```

### Eisenhower Classification Response

```json
{
  "success": true,
  "result": {
    "type": "EisenhowerClassification",
    "quadrant": "SCHEDULE",
    "confidence": 0.85,
    "explanation": "Health appointment with specific time scheduled for tomorrow",
    "isUrgent": false,
    "isImportant": true
  },
  "metadata": {
    "provider": "rule-based",
    "model": "rule-based",
    "latencyMs": 45,
    "tokensUsed": 0,
    "wasRuleBased": true,
    "wasLlmFallback": false
  }
}
```

---

## Dependencies

```toml
# libs.versions.toml
[versions]
kotlinxSerialization = "1.6.3"

[libraries]
kotlinx-serialization-json = { group = "org.jetbrains.kotlinx", name = "kotlinx-serialization-json", version.ref = "kotlinxSerialization" }

[plugins]
kotlin-serialization = { id = "org.jetbrains.kotlin.plugin.serialization", version.ref = "kotlin" }
```

---

## Cloud API Compatibility

The API contract is designed to match future backend endpoints:

| Endpoint | Request Type | Response Type |
|----------|--------------|---------------|
| POST /api/v1/ai/classify | AiRequest | AiResponse |
| POST /api/v1/ai/parse | AiRequest | AiResponse |
| POST /api/v1/ai/briefing | AiRequest | AiResponse |

This enables seamless switching between on-device and cloud AI providers.

---

## Unit Tests

```kotlin
@Test
fun `AiRequest serializes correctly`() {
    val request = AiRequest(
        type = AiRequestType.CLASSIFY_EISENHOWER,
        input = "Call dentist tomorrow"
    )
    
    val json = Json.encodeToString(request)
    val decoded = Json.decodeFromString<AiRequest>(json)
    
    assertEquals(request.type, decoded.type)
    assertEquals(request.input, decoded.input)
}
```

---

*Document Owner: Android Developer*  
*Last Updated: February 4, 2026*
