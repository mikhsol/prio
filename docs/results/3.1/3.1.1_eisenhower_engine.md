# 3.1.1 - EisenhowerEngine Implementation Report

## Overview

The EisenhowerEngine is a domain-level service that classifies task descriptions into Eisenhower Matrix quadrants using rule-based pattern matching with optional LLM escalation.

## Implementation Details

### File Location
`android/core/domain/src/main/java/com/prio/core/domain/eisenhower/EisenhowerEngine.kt`

### Class Structure

```kotlin
class EisenhowerEngine {
    companion object {
        const val LLM_ESCALATION_THRESHOLD = 0.65f
    }
    
    fun classify(taskDescription: String, deadline: Instant? = null): EisenhowerClassificationResult
    fun classifyBatch(tasks: List<Pair<String, Instant?>>): List<EisenhowerClassificationResult>
}
```

### Pattern Categories

#### Urgency Patterns (50+ patterns)
Detect time-sensitive tasks:
- Temporal markers: "today", "tonight", "now", "immediately", "ASAP"
- Deadline language: "due soon", "deadline", "expires", "by end of day"
- Crisis keywords: "urgent", "emergency", "critical", "alert", "outage"

#### Importance Patterns (50+ patterns)
Detect strategic/high-value tasks:
- Strategic: "strategic", "vision", "mission", "key objective"
- Growth: "career", "promotion", "development", "learning"
- Relationships: "client", "stakeholder", "leadership", "board"
- Financial: "revenue", "profit", "budget", "investment"

#### Delegation Patterns (50+ patterns)
Detect tasks suitable for delegation:
- Role indicators: "intern", "assistant", "team", "delegate to"
- Routine tasks: "routine", "standard", "regular check"
- Meeting coordination: "schedule meeting", "arrange", "coordinate"

#### Low Priority Patterns (50+ patterns)
Detect eliminable tasks:
- Optional markers: "maybe", "someday", "if time permits"
- Entertainment: "browse", "scroll", "watch videos", "social media"
- Non-essential: "reorganize", "clean up", "nice to have"

### Scoring Algorithm

```kotlin
// Calculate urgency/importance scores
val urgencyScore = calculateUrgencyScore(text, deadline)
val importanceScore = calculateImportanceScore(text)
val delegationScore = calculateDelegationScore(text)
val lowPriorityScore = calculateLowPriorityScore(text)

// Apply deadline boost to urgency
val deadlineBoost = when {
    deadline.isOverdue() -> 0.4f
    deadline.within(24.hours) -> 0.3f
    deadline.within(3.days) -> 0.2f
    deadline.within(7.days) -> 0.1f
    else -> 0f
}

// Classify quadrant based on scores
val quadrant = when {
    urgencyScore > 0.5f && importanceScore > 0.5f -> DO_FIRST
    importanceScore > 0.5f && urgencyScore <= 0.5f -> SCHEDULE
    urgencyScore > 0.5f && delegationScore > 0.3f -> DELEGATE
    else -> ELIMINATE
}
```

### Confidence Calculation

Confidence is based on:
1. Score margin (how clearly task fits one quadrant)
2. Number of matching patterns
3. Strength of pattern matches

```kotlin
val confidence = when {
    strongMatch && multiplePatterns -> 0.9f
    clearQuadrant && somePatterns -> 0.75f
    weakSignals -> 0.5f
    noPatterns -> 0.3f
}

val shouldUseLlm = confidence < LLM_ESCALATION_THRESHOLD
```

### Deadline-Based Urgency (TM-005)

Per user story TM-005, deadline proximity affects urgency:

| Deadline | Urgency Boost | Effect |
|----------|---------------|--------|
| Overdue | +0.4 | Guaranteed Q1 if important |
| <24 hours | +0.3 | Strong Q1/Q3 signal |
| <3 days | +0.2 | Moderate urgency signal |
| <7 days | +0.1 | Slight urgency signal |
| >7 days | +0.0 | No urgency boost |

## Test Coverage

### Test File
`android/core/domain/src/test/java/com/prio/core/domain/eisenhower/EisenhowerEngineTest.kt`

### Test Categories

#### Q1 - Do First Tests (20 cases)
- Crisis keywords: "URGENT: production down"
- Deadline pressure: "submit by end of day"
- Combined signals: "emergency client meeting today"

#### Q2 - Schedule Tests (20 cases)
- Strategic tasks: "plan career development"
- Learning: "study for certification"
- Important relationships: "mentor junior developer"

#### Q3 - Delegate Tests (20 cases)
- Routine tasks: "have assistant book travel"
- Team work: "team updates the spreadsheet"
- Meeting coordination: "schedule team standup"

#### Q4 - Eliminate Tests (20 cases)
- Optional: "maybe browse reddit later"
- Entertainment: "watch youtube videos"
- Non-essential: "reorganize bookshelf someday"

### Performance Tests

```kotlin
@Test
fun `classification completes within 100ms`() {
    val tasks = generateRandomTasks(100)
    val startTime = System.currentTimeMillis()
    
    tasks.forEach { engine.classify(it) }
    
    val elapsed = System.currentTimeMillis() - startTime
    assertThat(elapsed / 100).isLessThan(100) // <100ms per task
}
```

### Accuracy Targets

| Metric | Target | Tested |
|--------|--------|--------|
| Overall Accuracy | ≥75% | ✅ |
| DO_FIRST (Q1) | ≥90% | ✅ |
| SCHEDULE (Q2) | ≥75% | ✅ |
| DELEGATE (Q3) | ≥70% | ✅ |
| ELIMINATE (Q4) | ≥70% | ✅ |

## Integration Points

### TaskRepository Integration
```kotlin
// In TaskRepository or use case
suspend fun createTask(title: String, deadline: Instant?) {
    val classification = eisenhowerEngine.classify(title, deadline)
    val task = TaskEntity(
        title = title,
        quadrant = classification.quadrant,
        aiConfidence = classification.confidence,
        deadline = deadline
    )
    taskDao.insert(task)
}
```

### RuleBasedFallbackProvider Integration
```kotlin
// Provider delegates to engine for classification
class RuleBasedFallbackProvider(
    private val eisenhowerEngine: EisenhowerEngine
) : AiProvider {
    override suspend fun classifyEisenhower(text: String) = 
        eisenhowerEngine.classify(text).toAiResult()
}
```

## Future Enhancements

1. **LLM Hybrid Mode**: When `shouldUseLlm = true`, escalate to on-device LLM
2. **User Preference Learning**: Adjust weights based on user overrides
3. **Context Awareness**: Consider task source (email, calendar) for classification
4. **Pattern Expansion**: Add domain-specific patterns (healthcare, legal, etc.)
