# 3.1.2 - Task List Screen Implementation Report

## Overview

The Task List Screen is the primary interface for viewing and managing tasks, implementing requirement 3.1.2 with full MVVM architecture, filter support, and accessibility compliance.

## Implementation Details

### File Locations

| File | Purpose |
|------|---------|
| `TaskListScreen.kt` | Composable UI implementation |
| `TaskListViewModel.kt` | State management and business logic |
| `TaskListUiState.kt` | UI state models and events |

### Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TaskListScreen                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                  Scaffold                            â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚  TopAppBar (Search, Filter buttons)            â”‚ â”‚â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚
â”‚  â”‚  â”‚  FilterChipsRow (All, Today, Upcoming...)      â”‚ â”‚â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚
â”‚  â”‚  â”‚  LazyColumn                                    â”‚ â”‚â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ SectionHeader (Q1 - Do First)            â”‚ â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ SwipeableTaskCard                     â”‚ â”‚â”‚
â”‚  â”‚  â”‚  â”œâ”€â”€ SectionHeader (Q2 - Schedule)            â”‚ â”‚â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€â”€ SwipeableTaskCard                     â”‚ â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€ ...                                       â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚â”‚
â”‚  â”‚  â”‚  FAB (+)                                       â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State Model

```kotlin
data class TaskListUiState(
    val sections: List<TaskSection> = emptyList(),
    val currentFilter: TaskFilter = TaskFilter.ALL,
    val searchQuery: String = "",
    val isSearchActive: Boolean = false,
    val collapsedSections: Set<EisenhowerQuadrant> = emptySet(),
    val isLoading: Boolean = true,
    val lastDeletedTask: TaskUiModel? = null,
    val lastCompletedTask: TaskUiModel? = null
)

data class TaskSection(
    val quadrant: EisenhowerQuadrant,
    val title: String,
    val tasks: List<TaskUiModel>,
    val taskCount: Int
)
```

### Event Handling

```kotlin
sealed interface TaskListEvent {
    data class ChangeFilter(val filter: TaskFilter) : TaskListEvent
    data class UpdateSearchQuery(val query: String) : TaskListEvent
    data class TaskClicked(val taskId: String) : TaskListEvent
    data class CompleteTask(val taskId: String) : TaskListEvent
    data class DeleteTask(val taskId: String) : TaskListEvent
    data class ToggleSectionCollapse(val quadrant: EisenhowerQuadrant) : TaskListEvent
    object ToggleSearch : TaskListEvent
    object ToggleFilterSheet : TaskListEvent
    object UndoLastAction : TaskListEvent
}
```

### Effects (Side Effects)

```kotlin
sealed interface TaskListEffect {
    data class ShowUndoSnackbar(val message: String) : TaskListEffect
    data class NavigateToTaskDetail(val taskId: String) : TaskListEffect
    data class ShowError(val message: String) : TaskListEffect
}
```

## Features

### 1. Quadrant Sections

Tasks grouped by Eisenhower quadrant in priority order:

| Order | Quadrant | Title | Color |
|-------|----------|-------|-------|
| 1 | DO_FIRST | ğŸ”´ Do First | #DC2626 |
| 2 | SCHEDULE | ğŸŸ¡ Schedule | #F59E0B |
| 3 | DELEGATE | ğŸŸ  Delegate | #F97316 |
| 4 | ELIMINATE | âšª Maybe Later | #6B7280 |

### 2. Filter Chips

| Filter | Logic | Description |
|--------|-------|-------------|
| All | No filter | All incomplete tasks |
| Today | `deadline == today` | Due today |
| Upcoming | `deadline in 7 days` | Due within a week |
| Has Goal | `goalId != null` | Linked to a goal |
| Recurring | `isRecurring == true` | Recurring tasks |

### 3. Swipe Actions

```kotlin
SwipeToDismissBox(
    backgroundContent = { SwipeBackground(...) },
    enableDismissFromStartToEnd = true,  // Complete (green)
    enableDismissFromEndToStart = true   // Delete (red)
)
```

- **Swipe Left â†’ Right**: Mark complete (green background, check icon)
- **Swipe Right â†’ Left**: Delete (red background, trash icon)
- Both actions show undo snackbar

### 4. Section Collapse

```kotlin
// Click header to toggle
val isCollapsed = quadrant in state.collapsedSections

// Animated arrow rotation
val rotationAngle by animateFloatAsState(
    targetValue = if (isCollapsed) -90f else 0f
)
```

### 5. Search

Real-time search filtering with debounce:

```kotlin
private fun filterTasks(query: String): List<TaskSection> {
    return allTasks
        .filter { it.title.contains(query, ignoreCase = true) }
        .groupByQuadrant()
}
```

### 6. Due Date Formatting

Per 1.1.1 specification:

```kotlin
fun formatDueDate(deadline: Instant, now: Instant): String {
    val daysUntil = deadline.daysUntil(now)
    return when {
        daysUntil < 0 -> "Overdue"
        daysUntil == 0 -> "Today"
        daysUntil == 1 -> "Tomorrow"
        daysUntil < 7 -> deadline.dayOfWeek.name  // "Friday"
        else -> deadline.format("MMM d")  // "Jan 15"
    }
}
```

## Accessibility (WCAG 2.1 AA)

### Touch Targets
- All interactive elements â‰¥48dp
- Checkbox wrapped in 48dp Box
- FAB standard 56dp size

### Screen Reader Support
```kotlin
Modifier.semantics {
    contentDescription = "Priority ${quadrant.label}. ${task.title}. " +
        (if (isOverdue) "Overdue. " else "") +
        (dueText?.let { "Due $it. " } ?: "")
}
```

### Section Headers
```kotlin
Modifier.semantics { heading() }  // Marks as heading for TalkBack
```

### State Announcements
- Filter chip: "All filter, selected"
- Collapse: "Expand section" / "Collapse section"
- Swipe: Visual + haptic feedback

## Performance

### LazyColumn Optimization
```kotlin
LazyColumn {
    items(
        items = section.tasks,
        key = { it.id }  // Stable keys for recomposition
    ) { task ->
        SwipeableTaskCard(task)
    }
}
```

### State Collection
```kotlin
val state by viewModel.state.collectAsStateWithLifecycle()
```

Using `collectAsStateWithLifecycle` ensures:
- Automatic lifecycle awareness
- No collection during background
- Memory efficient

### Metrics
| Metric | Target | Implementation |
|--------|--------|----------------|
| Scroll FPS | â‰¥60fps | LazyColumn + stable keys |
| Initial Load | <500ms | Async loading with skeleton |
| Filter Change | <100ms | In-memory filtering |

## Testing

### ViewModel Tests
```kotlin
@Test
fun `filtering by Today shows only today's tasks`() {
    // Given tasks with various deadlines
    viewModel.onEvent(TaskListEvent.ChangeFilter(TaskFilter.TODAY))
    
    // Then only today's tasks visible
    assertThat(state.sections.flatMap { it.tasks })
        .allMatch { it.dueText == "Today" }
}
```

### UI Tests (Compose)
```kotlin
@Test
fun swipeToComplete_showsUndoSnackbar() {
    composeTestRule.setContent { TaskListScreen() }
    
    composeTestRule.onNodeWithText("Task title")
        .performTouchInput { swipeRight() }
    
    composeTestRule.onNodeWithText("Undo")
        .assertIsDisplayed()
}
```

## Dependencies

```kotlin
// build.gradle.kts
implementation(libs.hilt.navigation.compose)
implementation(libs.lifecycle.compose)
implementation(libs.compose.material3)
implementation(libs.kotlinx.datetime)
```

## Future Enhancements

1. **Drag & Drop Reordering**: Manual priority override within quadrant
2. **Multi-Select Mode**: Bulk actions (complete, delete, move)
3. **Quick Add**: Inline task creation without navigating
4. **Voice Input**: Microphone button in FAB
5. **Widget Support**: Home screen task list widget
